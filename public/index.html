<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Site Bug Crawler</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,"SF Pro",sans-serif;background:linear-gradient(145deg,#0a0a12,#1a1a2e,#0f1922);min-height:100vh;color:#e0e0e0;padding:20px 20px 100px}.container{max-width:800px;margin:0 auto}.header{text-align:center;padding:40px 0 30px}.logo{font-size:60px;margin-bottom:12px}.header h1{font-size:32px;font-weight:800;background:linear-gradient(135deg,#5e81f4,#1fcfc1,#5e81f4);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:shimmer 3s linear infinite;margin-bottom:8px}@keyframes shimmer{to{background-position:200% center}}.tagline{color:#666;font-size:14px}.input-section{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:24px;margin-bottom:24px}.input-group{margin-bottom:16px}.input-group label{display:block;font-size:11px;text-transform:uppercase;letter-spacing:1px;color:#888;margin-bottom:8px}.input-group input,.input-group select{width:100%;padding:16px 20px;background:rgba(0,0,0,.4);border:2px solid rgba(255,255,255,.1);border-radius:12px;color:#fff;font-size:16px;-webkit-appearance:none}.input-group input:focus,.input-group select:focus{outline:none;border-color:#5e81f4}.input-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}.btn{display:block;width:100%;padding:18px 24px;border:none;border-radius:14px;font-size:16px;font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:1px}.btn:active{transform:scale(.98)}.btn-primary{background:linear-gradient(135deg,#1fcfc1,#0ea89d);color:#fff}.btn-stop{background:linear-gradient(135deg,#ff6b6b,#d63031);color:#fff}.btn:disabled{opacity:.5}.status-section{display:none;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:24px;margin-bottom:24px}.status-section.active{display:block}.status-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.status-title{font-size:18px;font-weight:600;color:#5e81f4}.status-badge{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase}.status-badge.running{background:rgba(31,207,193,.2);color:#1fcfc1}.status-badge.complete{background:rgba(94,129,244,.2);color:#5e81f4}.status-badge.error{background:rgba(255,107,107,.2);color:#ff6b6b}.progress-bar{height:8px;background:rgba(255,255,255,.1);border-radius:4px;overflow:hidden;margin-bottom:8px}.progress-fill{height:100%;background:linear-gradient(90deg,#5e81f4,#1fcfc1);width:0%;transition:width .5s}.progress-text{display:flex;justify-content:space-between;font-size:13px;color:#888}.current-url{font-size:12px;color:#666;word-break:break-all;padding:10px;background:rgba(0,0,0,.3);border-radius:8px;margin-top:12px}.results-section{display:none}.results-section.active{display:block}.summary-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:24px}@media(min-width:600px){.summary-grid{grid-template-columns:repeat(4,1fr)}}.summary-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:20px;text-align:center}.summary-card.issues{border-color:rgba(255,107,107,.3)}.summary-card.good{border-color:rgba(31,207,193,.3)}.summary-value{font-size:32px;font-weight:700;color:#5e81f4}.summary-card.issues .summary-value{color:#ff6b6b}.summary-card.good .summary-value{color:#1fcfc1}.summary-label{font-size:11px;text-transform:uppercase;color:#888;margin-top:4px}.issue-section{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;margin-bottom:16px;overflow:hidden}.issue-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;background:rgba(0,0,0,.2);cursor:pointer}.issue-title{font-size:14px;font-weight:600;display:flex;align-items:center;gap:10px}.issue-count{background:rgba(255,107,107,.2);color:#ff6b6b;padding:4px 10px;border-radius:12px;font-size:12px;font-weight:700}.issue-count.zero{background:rgba(31,207,193,.2);color:#1fcfc1}.issue-toggle{color:#666;font-size:18px;transition:transform .2s}.issue-section.open .issue-toggle{transform:rotate(180deg)}.issue-list{display:none;max-height:400px;overflow-y:auto}.issue-section.open .issue-list{display:block}.issue-item{padding:14px 20px;border-top:1px solid rgba(255,255,255,.05);font-size:13px}.issue-url{color:#5e81f4;word-break:break-all;margin-bottom:4px}.issue-detail{color:#999;font-size:12px}.issue-page{color:#666;font-size:11px;margin-top:4px}.page-item{display:flex;justify-content:space-between;padding:12px 20px;border-top:1px solid rgba(255,255,255,.05)}.page-url{flex:1;font-size:12px;color:#aaa;word-break:break-all;margin-right:10px}.page-time{font-size:11px;color:#666}.page-time.slow{color:#ff6b6b}.actions{display:flex;gap:12px;margin-top:24px}.btn-secondary{flex:1;background:rgba(94,129,244,.2);color:#5e81f4;border:2px solid #5e81f4}.empty-state{text-align:center;padding:40px 20px;color:#666}.empty-icon{font-size:48px;margin-bottom:16px;opacity:.5}
    </style>
</head>
<body>
    <div class="container">
        <div class="header"><div class="logo">üîç</div><h1>Site Bug Crawler</h1><p class="tagline">Find broken links, JS errors, and issues across your entire site</p></div>
        <div class="input-section" id="input-section">
            <div class="input-group"><label>Website URL</label><input type="url" id="url-input" placeholder="https://yoursite.com"></div>
            <div class="input-row"><div class="input-group"><label>Max Pages</label><select id="max-pages"><option value="10">10 pages</option><option value="25">25 pages</option><option value="50" selected>50 pages</option><option value="100">100 pages</option></select></div><div class="input-group"><label>Max Depth</label><select id="max-depth"><option value="2">2 levels</option><option value="3" selected>3 levels</option><option value="5">5 levels</option></select></div></div>
            <button class="btn btn-primary" id="start-btn">Start Crawl</button>
        </div>
        <div class="status-section" id="status-section">
            <div class="status-header"><span class="status-title">Crawl Progress</span><span class="status-badge running" id="status-badge">Running</span></div>
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <div class="progress-text"><span id="pages-scanned">0 / 50 pages</span><span id="elapsed-time">0s elapsed</span></div>
            <div class="current-url" id="current-url">Starting...</div>
            <button class="btn btn-stop" id="stop-btn" style="margin-top:16px">Stop Crawl</button>
        </div>
        <div class="results-section" id="results-section">
            <div class="summary-grid" id="summary-grid"></div>
            <div id="issues-container"></div>
            <div class="actions"><button class="btn btn-secondary" id="export-btn">Export JSON</button><button class="btn btn-primary" id="new-crawl-btn">New Crawl</button></div>
        </div>
    </div>
    <script>
        const urlInput=document.getElementById('url-input'),maxPagesSelect=document.getElementById('max-pages'),maxDepthSelect=document.getElementById('max-depth'),startBtn=document.getElementById('start-btn'),stopBtn=document.getElementById('stop-btn'),exportBtn=document.getElementById('export-btn'),newCrawlBtn=document.getElementById('new-crawl-btn'),inputSection=document.getElementById('input-section'),statusSection=document.getElementById('status-section'),resultsSection=document.getElementById('results-section'),statusBadge=document.getElementById('status-badge'),progressFill=document.getElementById('progress-fill'),pagesScanned=document.getElementById('pages-scanned'),elapsedTime=document.getElementById('elapsed-time'),currentUrl=document.getElementById('current-url'),summaryGrid=document.getElementById('summary-grid'),issuesContainer=document.getElementById('issues-container');let currentJobId=null,pollInterval=null,resultsData=null;startBtn.addEventListener('click',async()=>{let url=urlInput.value.trim();if(!url)return alert('Please enter a URL');if(!url.startsWith('http://') && !url.startsWith('https://'))url='https://'+url,urlInput.value=url;const maxPages=parseInt(maxPagesSelect.value),maxDepth=parseInt(maxDepthSelect.value);try{startBtn.disabled=true;startBtn.textContent='Starting...';const response=await fetch('/api/crawl',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({url,maxPages,maxDepth})});const data=await response.json();if(data.error)return alert('Error: '+data.error),startBtn.disabled=false,startBtn.textContent='Start Crawl';currentJobId=data.jobId;inputSection.style.display='none';statusSection.classList.add('active');resultsSection.classList.remove('active');pollStatus();pollInterval=setInterval(pollStatus,1000)}catch(error){alert('Error: '+error.message);startBtn.disabled=false;startBtn.textContent='Start Crawl'}});async function pollStatus(){if(!currentJobId)return;try{const response=await fetch(`/api/status/${currentJobId}`);const data=await response.json();const maxPages=parseInt(maxPagesSelect.value);const progress=(data.pagesScanned/maxPages)*100;progressFill.style.width=Math.min(progress,100)+'%';pagesScanned.textContent=`${data.pagesScanned} / ${maxPages} pages`;elapsedTime.textContent=`${data.elapsedTime}s elapsed`;if(data.currentUrl)currentUrl.textContent=data.currentUrl;if(data.status==='complete'||data.status==='error'||data.status==='stopped'){clearInterval(pollInterval);statusBadge.textContent=data.status;statusBadge.className='status-badge '+data.status;loadResults()}}catch(error){console.error('Error:',error)}}async function loadResults(){if(!currentJobId)return;try{const response=await fetch(`/api/results/${currentJobId}`);resultsData=await response.json();displayResults(resultsData);statusSection.classList.remove('active');resultsSection.classList.add('active')}catch(error){console.error('Error:',error)}}function displayResults(data){const s=data.summary;const totalIssues=s.brokenLinks+s.jsErrors+s.missingImages+s.deadButtons+s.slowPages+s.missingAlt+s.formIssues;summaryGrid.innerHTML=`<div class="summary-card good"><div class="summary-value">${s.totalPages}</div><div class="summary-label">Pages</div></div><div class="summary-card ${totalIssues>0?'issues':'good'}"><div class="summary-value">${totalIssues}</div><div class="summary-label">Issues</div></div><div class="summary-card ${s.brokenLinks>0?'issues':'good'}"><div class="summary-value">${s.brokenLinks}</div><div class="summary-label">Broken</div></div><div class="summary-card ${s.jsErrors>0?'issues':'good'}"><div class="summary-value">${s.jsErrors}</div><div class="summary-label">JS Errors</div></div>`;const issueTypes=[{key:'brokenLinks',label:'üîó Broken Links'},{key:'jsErrors',label:'‚ö†Ô∏è JS Errors'},{key:'missingImages',label:'üñºÔ∏è Missing Images'},{key:'deadButtons',label:'üîò Dead Buttons'},{key:'slowPages',label:'üê¢ Slow Pages'},{key:'missingAlt',label:'‚ôø Missing Alt'},{key:'formIssues',label:'üìù Form Issues'},{key:'pages',label:'üìÑ All Pages'}];issuesContainer.innerHTML=issueTypes.map(type=>{const items=data.results[type.key]||[];return`<div class="issue-section" data-key="${type.key}"><div class="issue-header" onclick="this.parentElement.classList.toggle('open')"><span class="issue-title">${type.label}<span class="issue-count ${items.length===0?'zero':''}">${items.length}</span></span><span class="issue-toggle">‚ñº</span></div><div class="issue-list">${items.length===0?'<div class="empty-state"><div class="empty-icon">‚úì</div><div>No issues</div></div>':items.map(item=>renderItem(type.key,item)).join('')}</div></div>`}).join('')}function renderItem(type,item){if(type==='pages')return`<div class="page-item"><div class="page-url">${esc(item.url)}</div><div class="page-time ${item.loadTime>3000?'slow':''}">${item.loadTime?(item.loadTime/1000).toFixed(2)+'s':'error'}</div></div>`;if(type==='jsErrors')return`<div class="issue-item"><div class="issue-detail" style="color:#ff6b6b">${esc(item.message)}</div><div class="issue-page">Found on: ${esc(item.foundOn)}</div></div>`;if(type==='slowPages')return`<div class="issue-item"><div class="issue-url">${esc(item.url)}</div><div class="issue-detail" style="color:#ff6b6b">${(item.loadTime/1000).toFixed(2)}s</div></div>`;return`<div class="issue-item"><div class="issue-url">${esc(item.url||item.src||item.text||item.issue||'')}</div>${item.foundOn?`<div class="issue-page">Found on: ${esc(item.foundOn)}</div>`:''}</div>`}function esc(t){if(!t)return'';const d=document.createElement('div');d.textContent=t;return d.innerHTML}stopBtn.addEventListener('click',async()=>{if(!currentJobId)return;await fetch(`/api/stop/${currentJobId}`,{method:'POST'});clearInterval(pollInterval);loadResults()});exportBtn.addEventListener('click',()=>{if(!resultsData)return;const blob=new Blob([JSON.stringify(resultsData,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`crawl-${new Date().toISOString().slice(0,10)}.json`;a.click()});newCrawlBtn.addEventListener('click',()=>{currentJobId=null;resultsData=null;inputSection.style.display='block';statusSection.classList.remove('active');resultsSection.classList.remove('active');startBtn.disabled=false;startBtn.textContent='Start Crawl';progressFill.style.width='0%'});urlInput.addEventListener('keypress',e=>{if(e.key==='Enter')startBtn.click()});
    </script>
</body>
</html>
